<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n-key="title">LumiStream Realm - Future Video Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cn-fontsource-lxgw-marker-gothic-regular/index.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        /* 使用 LXGW Marker Gothic 字體 */
        body {
            font-family: 'LXGW Marker Gothic', sans-serif;
            background-color: #0a0a0a; /* 更深的背景色 */
            color: #e0e0e0; /* 淺色文字 */
        }
        /* 自定義滾動條樣式 */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1a1a1a; /* 深色滾動條軌道 */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #333333; /* 深色滾動條拇指 */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555555; /* 懸停時顏色變深 */
        }
        /* 影片卡片縮圖的固定比例 */
        .thumbnail-container {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%; /* 16:9 比例 */
            overflow: hidden;
            border-radius: 0.5rem; /* 圓角 */
        }
        .thumbnail-container img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        /* 針對高科技感的按鈕樣式 */
        .tech-button {
            background: linear-gradient(90deg, #00eaff, #ff00e0); /* 霓虹漸變背景 */
            box-shadow: 0 4px 15px 0 rgba(0, 234, 255, 0.5); /* 淺藍色光暈陰影 */
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); /* 更流暢的過渡 */
            border: 1px solid rgba(0, 234, 255, 0.6); /* 淺藍色邊框 */
        }
        .tech-button:hover {
            background: linear-gradient(90deg, #ff00e0, #00eaff); /* 懸停時漸變反轉 */
            box-shadow: 0 6px 25px 0 rgba(255, 0, 224, 0.7); /* 懸停時粉色光暈陰影 */
            transform: translateY(-3px); /* 輕微上浮 */
            border-color: rgba(255, 0, 224, 0.8); /* 懸停時粉色邊框 */
        }
        .tech-button:active {
            transform: translateY(0);
            box-shadow: none;
        }

        /* 側邊欄項目懸停效果 */
        .sidebar-item {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        .sidebar-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(to bottom, #00eaff, #ff00e0); /* 漸變發光條 */
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }
        .sidebar-item:hover {
            background-color: #1a1a1a; /* 深色懸停背景 */
            color: #00eaff; /* 文字變色 */
        }
        .sidebar-item:hover::before {
            transform: translateX(0); /* 發光條滑入 */
        }

        /* 針對 Font Awesome 圖示的強制樣式 */
        .fas, .far, .fab {
            display: inline-block !important;
            visibility: visible !important;
            font-style: normal !important; /* 確保不被斜體 */
            font-variant: normal !important; /* 確保不被變體 */
            text-rendering: auto !important; /* 確保渲染 */
            -webkit-font-smoothing: antialiased !important; /* 抗鋸齒 */
            -moz-osx-font-smoothing: grayscale !important; /* 抗鋸齒 */
            line-height: 1 !important; /* 標準行高 */
            vertical-align: -0.125em !important; /* 對齊 */
            font-size: inherit !important; /* 繼承父元素字體大小 */
            color: inherit !important; /* 繼承父元素顏色 */
        }

        /* 確保 Font Awesome 字體家族被正確應用 */
        .fas { font-family: 'Font Awesome 6 Free' !important; font-weight: 900 !important; }
        .far { font-family: 'Font Awesome 6 Free' !important; font-weight: 400 !important; }
        .fab { font-family: 'Font Awesome 6 Brands' !important; }

        /* 側邊欄圖示顏色過渡 */
        .sidebar-item .fas,
        .sidebar-item .far,
        .sidebar-item .fab {
            transition: color 0.3s ease;
        }
        .sidebar-item:hover .fas,
        .sidebar-item:hover .far,
        .sidebar-item:hover .fab {
            color: #00eaff !important; /* 懸停時圖示顏色變色 */
        }

        /* 影片卡片懸停效果 */
        .video-card-hover:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 10px 30px rgba(0, 234, 255, 0.3), 0 0 15px rgba(255, 0, 224, 0.3); /* 雙色光暈 */
            border-color: rgba(0, 234, 255, 0.5);
        }

        /* 訊息彈窗樣式 */
        .message-box {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #1a1a1a;
            color: #00eaff;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 234, 255, 0.3);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            border: 1px solid #00eaff;
        }
        .message-box.show {
            opacity: 1;
        }

        /* 分類標籤圖示樣式 */
        .category-tag .fas,
        .category-tag .far,
        .category-tag .fab {
            margin-right: 0.5rem;
            font-size: 1rem !important; /* 調整大小 */
            transition: color 0.2s ease;
        }
        .category-tag:hover .fas,
        .category-tag:hover .far,
        .category-tag:hover .fab {
            color: inherit !important; /* 繼承父元素的hover顏色 */
        }

        /* 帳號選單樣式 */
        .account-menu {
            position: absolute;
            top: calc(100% + 10px); /* 位於頭像下方 */
            right: 0;
            background-color: #1a1a1a;
            border: 1px solid #333333;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            width: 200px;
            z-index: 50;
            opacity: 0;
            transform: translateY(-10px);
            transition: opacity 0.2s ease-out, transform 0.2s ease-out;
            pointer-events: none; /* 預設不響應事件 */
        }
        .account-menu.show {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto; /* 顯示時響應事件 */
        }
        .account-menu ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .account-menu li a {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            color: #e0e0e0;
            text-decoration: none;
            transition: background-color 0.2s ease, color 0.2s ease;
        }
        .account-menu li a:hover {
            background-color: #333333;
            color: #00eaff;
        }
        .account-menu li a .fas,
        .account-menu li a .far,
        .account-menu li a .fab {
            margin-right: 10px;
            font-size: 1.25rem !important; /* 調整字體大小 */
            color: #888 !important; /* 預設圖示顏色 */
        }
        .account-menu li a:hover .fas,
        .account-menu li a:hover .far,
        .account-menu li a:hover .fab {
            color: #00eaff !important; /* 懸停時圖示顏色變色 */
        }

        /* 語言子選單樣式 */
        .language-submenu {
            display: none; /* 預設隱藏 */
            padding-left: 20px; /* 子選單項目縮排 */
            border-top: 1px solid #2d3748;
            margin-top: 5px;
            padding-top: 5px;
        }
        .language-submenu.show {
            display: block;
        }
        .language-submenu li a {
            padding: 8px 15px; /* 子選單項目較小填充 */
        }

        /* 載入遮罩樣式 */
        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: black; /* 完全不透明的黑色背景 */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999; /* 確保在最上層 */
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }
        #loading-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        /* 可愛載入動畫 (愛心跳動) 樣式 */
        .cute-spinner {
            font-size: 3rem; /* 圖示大小 */
            color: #ff00e0; /* 愛心顏色 */
            animation: pulse 1s infinite alternate; /* 跳動動畫 */
        }

        @keyframes pulse {
            0% { transform: scale(0.8); opacity: 0.7; }
            100% { transform: scale(1.2); opacity: 1; }
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">
    <header class="bg-black shadow-2xl p-4 flex items-center justify-between sticky top-0 z-20 border-b border-gray-800">
        <div class="flex items-center space-x-3">
            <button id="sidebar-toggle" class="lg:hidden p-2 rounded-full hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-cyan-500">
                <i class="fas fa-bars text-gray-400 text-xl"></i>
            </button>
            <div class="flex items-center text-cyan-400 text-3xl font-bold tracking-wider">
                <i class="fas fa-atom mr-2 text-cyan-400"></i> <span data-i18n-key="app_name">LumiStream Realm</span>
            </div>
        </div>

        <div class="flex-grow max-w-2xl mx-4 hidden sm:block">
            <div class="flex bg-gray-900 rounded-full border border-gray-700 focus-within:border-cyan-500 transition-all duration-300">
                <input type="text" data-i18n-key="search_placeholder" placeholder="Search videos..." class="w-full bg-transparent p-2 pl-6 text-gray-200 rounded-l-full focus:outline-none" style="box-shadow: none;">
                <button class="bg-gray-700 rounded-r-full px-6 text-gray-400 hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-cyan-500 transition-colors duration-200">
                    <i class="fas fa-search"></i>
                </button>
            </div>
        </div>

        <div class="flex items-center space-x-4 relative">
            <button class="tech-button text-white font-semibold py-2 px-5 rounded-full transition duration-300 ease-in-out hidden md:block">
                <i class="fas fa-upload mr-2"></i><span data-i18n-key="upload_button_text">Upload Video</span>
            </button>
            <div id="user-avatar" class="w-10 h-10 bg-gradient-to-br from-cyan-500 to-fuchsia-600 rounded-full flex items-center justify-center text-white text-lg font-semibold cursor-pointer hover:scale-105 transition duration-200 border-2 border-cyan-400">
                U
            </div>
            <div id="account-menu" class="account-menu">
                <ul>
                    <li><a href="#"><i class="fas fa-user-circle"></i><span data-i18n-key="account_menu_channel_text">My Channel</span></a></li>
                    <li><a href="#"><i class="fas fa-cog"></i><span data-i18n-key="account_menu_settings_text">Settings</span></a></li>
                    <li id="language-option"><a href="#"><i class="fas fa-globe"></i><span data-i18n-key="account_menu_language_text">Language</span></a>
                        <ul class="language-submenu" id="language-submenu">
                            <li><a href="#" data-lang="en">English</a></li>
                            <li><a href="#" data-lang="ja">日本語</a></li>
                            <li><a href="#" data-lang="zh-TW">繁體中文</a></li>
                            <li><a href="#" data-lang="zh-CN">简体中文</a></li>
                        </ul>
                    </li>
                    <li><a href="#"><i class="fas fa-question-circle"></i><span data-i18n-key="account_menu_help_text">Help</span></a></li>
                    <li><a href="#"><i class="fas fa-comment-dots"></i><span data-i18n-key="account_menu_feedback_text">Feedback</span></a></li>
                    <li><a href="#"><i class="fas fa-sign-out-alt"></i><span data-i18n-key="account_menu_signout_text">Sign Out</span></a></li>
                </ul>
            </div>
        </div>
    </header>

    <div class="flex flex-grow">
        <aside id="sidebar" class="w-64 bg-black shadow-xl p-4 flex flex-col flex-shrink-0 transition-transform duration-300 ease-in-out transform -translate-x-full lg:translate-x-0 lg:sticky lg:top-16 lg:h-[calc(100vh-64px)] overflow-y-auto z-10 border-r border-gray-800">
            <nav>
                <ul>
                    <li class="mb-2">
                        <a href="#" class="sidebar-item flex items-center p-3 rounded-lg text-gray-300 font-medium">
                            <i class="fas fa-home mr-4 text-cyan-400"></i><span data-i18n-key="sidebar_home_text">Home</span>
                        </a>
                    </li>
                    <li class="mb-2">
                        <a href="#" class="sidebar-item flex items-center p-3 rounded-lg text-gray-300 font-medium">
                            <i class="fas fa-compass mr-4 text-lime-400"></i><span data-i18n-key="sidebar_explore_text">Explore</span>
                        </a>
                    </li>
                    <li class="mb-2">
                        <a href="#" class="sidebar-item flex items-center p-3 rounded-lg text-gray-300 font-medium">
                            <i class="fas fa-play-circle mr-4 text-fuchsia-400"></i><span data-i18n-key="sidebar_subscriptions_text">Subscriptions</span>
                        </a>
                    </li>
                </ul>
                <hr class="my-4 border-gray-700">
                <ul>
                    <li class="mb-2">
                        <a href="#" class="sidebar-item flex items-center p-3 rounded-lg text-gray-300 font-medium">
                            <i class="fas fa-book mr-4 text-yellow-400"></i><span data-i18n-key="sidebar_library_text">Library</span>
                        </a>
                    </li>
                    <li class="mb-2">
                        <a href="#" class="sidebar-item flex items-center p-3 rounded-lg text-gray-300 font-medium">
                            <i class="fas fa-history mr-4 text-red-400"></i><span data-i18n-key="sidebar_history_text">History</span>
                        </a>
                    </li>
                    <li class="mb-2">
                        <a href="#" class="sidebar-item flex items-center p-3 rounded-lg text-gray-300 font-medium">
                            <i class="fas fa-film mr-4 text-indigo-400"></i><span data-i18n-key="sidebar_your_videos_text">Your Videos</span>
                        </a>
                    </li>
                    <li class="mb-2">
                        <a href="#" class="sidebar-item flex items-center p-3 rounded-lg text-gray-300 font-medium">
                            <i class="fas fa-clock mr-4 text-teal-400"></i><span data-i18n-key="sidebar_watch_later_text">Watch Later</span>
                        </a>
                    </li>
                    <li class="mb-2">
                        <a href="#" class="sidebar-item flex items-center p-3 rounded-lg text-gray-300 font-medium">
                            <i class="fas fa-heart mr-4 text-pink-400"></i><span data-i18n-key="sidebar_liked_videos_text">Liked Videos</span>
                        </a>
                    </li>
                </ul>
                <hr class="my-4 border-gray-700">
                <h4 class="text-sm font-semibold text-gray-500 mb-2 px-3" data-i18n-key="sidebar_more">More</h4>
                <ul>
                    <li class="mb-2">
                        <a href="#" class="sidebar-item flex items-center p-3 rounded-lg text-gray-300 font-medium">
                            <i class="fas fa-cog mr-4 text-gray-400"></i><span data-i18n-key="sidebar_settings_text">Settings</span>
                        </a>
                    </li>
                    <li class="mb-2">
                        <a href="#" class="sidebar-item flex items-center p-3 rounded-lg text-gray-300 font-medium">
                            <i class="fas fa-question-circle mr-4 text-gray-400"></i><span data-i18n-key="sidebar_help_text">Help</span>
                        </a>
                    </li>
                    <li class="mb-2">
                        <a href="#" class="sidebar-item flex items-center p-3 rounded-lg text-gray-300 font-medium">
                            <i class="fas fa-comment-dots mr-4 text-gray-400"></i><span data-i18n-key="sidebar_feedback_text">Feedback</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

        <main class="flex-grow p-6 bg-gray-900">
            <section class="mb-8">
                <h2 class="text-2xl font-bold text-yellow-400 mb-4" data-i18n-key="categories_title">Categories</h2>
                <div id="category-tags" class="flex flex-wrap gap-3">
                    <span class="category-tag bg-gray-700 text-gray-300 px-4 py-2 rounded-full cursor-pointer hover:bg-gray-600 hover:text-cyan-400 transition-colors duration-200 border border-gray-600" data-category="All Data"><i class="fas fa-globe mr-2"></i><span data-i18n-key="category_all_text">All</span></span>
                    <span class="category-tag bg-gray-700 text-gray-300 px-4 py-2 rounded-full cursor-pointer hover:bg-gray-600 hover:text-lime-400 transition-colors duration-200 border border-gray-600" data-category="Future Tech"><i class="fas fa-robot mr-2"></i><span data-i18n-key="category_tech_text">Tech</span></span>
                    <span class="category-tag bg-gray-700 text-gray-300 px-4 py-2 rounded-full cursor-pointer hover:bg-gray-600 hover:text-fuchsia-400 transition-colors duration-200 border border-gray-600" data-category="Space Exploration"><i class="fas fa-rocket mr-2"></i><span data-i18n-key="category_space_text">Space</span></span>
                    <span class="category-tag bg-gray-700 text-gray-300 px-4 py-2 rounded-full cursor-pointer hover:bg-gray-600 hover:text-red-400 transition-colors duration-200 border border-gray-600" data-category="AI Evolution"><i class="fas fa-brain mr-2"></i><span data-i18n-key="category_ai_text">AI</span></span>
                    <span class="category-tag bg-gray-700 text-gray-300 px-4 py-2 rounded-full cursor-pointer hover:bg-gray-600 hover:text-blue-400 transition-colors duration-200 border border-gray-600" data-category="Life Sciences"><i class="fas fa-dna mr-2"></i><span data-i18n-key="category_life_science_text">Life Science</span></span>
                    <span class="category-tag bg-gray-700 text-gray-300 px-4 py-2 rounded-full cursor-pointer hover:bg-gray-600 hover:text-green-400 transition-colors duration-200 border border-gray-600" data-category="Historical Data"><i class="fas fa-hourglass-half mr-2"></i><span data-i18n-key="category_history_text">History</span></span>
                </div>
            </section>

            <section class="mb-8">
                <h2 class="text-2xl font-bold text-cyan-400 mb-4" data-i18n-key="recommended_title">Recommended for You</h2>
                <div id="home-video-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
                    </div>
            </section>

            <section class="mb-8">
                <h2 class="text-2xl font-bold text-lime-400 mb-4" data-i18n-key="trending_title">Trending Videos</h2>
                <div id="trending-video-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
                    </div>
            </section>

            <section class="mb-8">
                <h2 class="text-2xl font-bold text-fuchsia-400 mb-4" data-i18n-key="music_title">Music</h2>
                <div id="music-video-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
                    </div>
            </section>
        </main>
    </div>

    <footer class="bg-black text-gray-600 p-4 text-center mt-6 border-t border-gray-800">
        <p data-i18n-key="footer_text">&copy; 2025 LumiStream Realm. All rights reserved.</p>
    </footer>

    <div id="message-box" class="message-box"></div>

    <!-- 載入遮罩 -->
    <div id="loading-overlay">
        <!-- 可愛載入動畫 (愛心圖示) -->
        <i class="fas fa-heart cute-spinner"></i>
    </div>

    <script>
        // Execute when the window is fully loaded
        window.onload = async function() {
            // Video data array - expanded with more videos
            const videos = [
                { id: 'dQw4w9WgXcQ', title: 'Quantum Encryption Protocol Demo', description: 'Explore the principles of next-generation secure communication technology.', thumbnail: 'https://placehold.co/1280x720/00eaff/000000?text=Quantum+Encryption', channel: 'Future Tech Lab', views: '2M', uploadTime: '3 days ago', category: 'Future Tech', isLive: false, isVerified: true },
                { id: 'xvFZjo5PgG0', title: 'Interstellar Travel: Warp Drive Concept', description: 'A deep dive into theoretical physicists\' proposals for faster-than-light travel.', thumbnail: 'https://placehold.co/1280x720/ff00e0/000000?text=Warp+Drive', channel: 'Cosmic Explorer', views: '5M', uploadTime: '1 week ago', category: 'Space Exploration', isLive: true, isVerified: false },
                { id: 'kXYiU_JCYtU', title: 'AI Consciousness Awakening: Simulation & Prediction', description: 'How will the world change when artificial intelligence reaches the threshold of self-awareness?', thumbnail: 'https://placehold.co/1280x720/99ff00/000000?text=AI+Awakening', channel: 'Digital Mind Center', views: '12M', uploadTime: '2 weeks ago', category: 'AI Evolution', isLive: false, isVerified: true },
                { id: 'p_yK2E0yF-s', title: 'Deep Sea Colonization: Underwater City Planning', description: 'Explore blueprints for sustainable human cities in the Earth\'s deep oceans.', thumbnail: 'https://placehold.co/1280x720/00aaff/000000?text=Deep+Sea+Colony', channel: 'Blue Planet Project', views: '8M', uploadTime: '1 month ago', category: 'Future Tech', isLive: false, isVerified: false },
                { id: 'EE-xtCF30D4', title: 'High-Dimensional Space Visualization', description: 'Experience spaces beyond three dimensions through advanced computer graphics.', thumbnail: 'https://placehold.co/1280x720/ffcc00/000000?text=Hyper+Space', channel: 'VR Lab', views: '3M', uploadTime: '2 months ago', category: 'Space Exploration', isLive: false, isVerified: true },
                { id: 'ZXsQAXx_ao0', title: 'Bionic Robots: Future Workforce', description: 'Observe the potential applications of the latest generation of bionic robots across various fields.', thumbnail: 'https://placehold.co/1280x720/cc00ff/000000?text=Bionic+Robots', channel: 'Robotics Institute', views: '6M', uploadTime: '3 months ago', category: 'AI Evolution', isLive: true, isVerified: false },
                { id: 'M_g4p5-0L4Q', title: 'Neural Interface Technology: Mind Control', description: 'Learn how direct control of external devices can be achieved through brain-computer interfaces.', thumbnail: 'https://placehold.co/1280x720/ff3366/000000?text=Neural+Interface', channel: 'Brain Science Frontier', views: '1.5M', uploadTime: '4 months ago', category: 'Life Sciences', isLive: false, isVerified: true },
                { id: 'LXb3EKWsInQ', title: 'Metamaterial Applications: Invisibility & Energy Shields', description: 'Explore revolutionary breakthroughs of metamaterials in military and civilian sectors.', thumbnail: 'https://placehold.co/1280x720/3366ff/000000?text=Metamaterials', channel: 'Materials Science Center', views: '4.5M', uploadTime: '5 months ago', category: 'Future Tech', isLive: false, isVerified: false },
                { id: 'sLg9J55V2zI', title: 'Time Travel Paradox: Theory & Practice', description: 'Is time travel physically possible? We delve into its complexities.', thumbnail: 'https://placehold.co/1280x720/ff6600/000000?text=Time+Paradox', channel: 'Theoretical Physics Inst.', views: '7M', uploadTime: '6 months ago', category: 'Space Exploration', isLive: false, isVerified: true },
                { id: 'J_Z1x_1X_2X', title: 'Mars Terraforming: Planetary Transformation Project', description: 'How can humanity transform Mars into a habitable second home?', thumbnail: 'https://placehold.co/1280x720/00ffaa/000000?text=Mars+Terraforming', channel: 'Planetary Engineering Bureau', views: '2.5M', uploadTime: '7 months ago', category: 'Space Exploration', isLive: false, isVerified: false },
                { id: 'K_Y2z_2Y_3Z', title: 'Nanobots: Revolution in Medicine & Manufacturing', description: 'How can microscopic robots perform surgery inside the body or assemble complex structures?', thumbnail: 'https://placehold.co/1280x720/ccff00/000000?text=Nanobots', channel: 'Micro-World Explorer', views: '1.8M', uploadTime: '8 months ago', category: 'Future Tech', isLive: false, isVerified: true },
                { id: 'L_A3x_3A_4B', title: 'Anti-Gravity Technology: Theory & Experiment', description: 'How are scientists attempting to challenge the laws of gravity?', thumbnail: 'https://placehold.co/1280x720/6633ff/000000?text=Anti-Gravity', channel: 'Physics Breakthroughs', views: '1M', uploadTime: '9 months ago', category: 'Future Tech', isLive: false, isVerified: false },
                { id: 'M_B4y_4B_5C', title: 'Virtual Reality: Limits of Sensory Simulation', description: 'Explore how VR technology can create experiences indistinguishable from reality.', thumbnail: 'https://placehold.co/1280x720/ff0066/000000?text=VR+Simulation', channel: 'Digital Sense Lab', views: '4M', uploadTime: '10 months ago', category: 'AI Evolution', isLive: false, isVerified: true },
                { id: 'N_C5z_5C_6D', title: 'Energy Shields: Future of Defensive Technology', description: 'From sci-fi to reality, what are the scientific foundations of energy shields?', thumbnail: 'https://placehold.co/1280x720/ff9900/000000?text=Energy+Shield', channel: 'Defense Systems Research', views: '900K', uploadTime: '11 months ago', category: 'Future Tech', isLive: true, isVerified: false },
                { id: 'O_D6x_6D_7E', title: 'Bioengineering: Gene Editing & Life Design', description: 'A deep dive into how CRISPR technology is changing our understanding of life.', thumbnail: 'https://placehold.co/1280x720/00ccff/000000?text=Bioengineering', channel: 'Life Science Frontier', views: '3.5M', uploadTime: '1 year ago', category: 'Life Sciences', isLive: false, isVerified: true },
                { id: 'P_E7y_7E_8F', title: 'Consciousness Upload: Path to Digital Immortality', description: 'When human consciousness can be digitized and stored, the definition of death will be rewritten.', thumbnail: 'https://placehold.co/1280x720/cc00ff/000000?text=Consciousness+Upload', channel: 'Future Philosophy Forum', views: '2.2M', uploadTime: '1 year 1 month ago', category: 'AI Evolution', isLive: false, isVerified: false },
                { id: 'Q_F8z_8F_9G', title: 'Quantum Computing: Breaking Traditional Limits', description: 'How can quantum computers solve problems beyond the capabilities of classical computers?', thumbnail: 'https://placehold.co/1280x720/ff6600/000000?text=Quantum+Computing', channel: 'Quantum Physics Society', views: '1.2M', uploadTime: '1 year 2 months ago', category: 'Future Tech', isLive: false, isVerified: true },
                { id: 'R_G9x_9G_0H', title: 'Interstellar Communication: New SETI Advances', description: 'How are humans attempting to establish contact with extraterrestrial civilizations?', thumbnail: 'https://placehold.co/1280x720/00ffcc/000000?text=SETI+Progress', channel: 'Cosmic Signal Analysis', views: '1.7M', uploadTime: '1 year 3 months ago', category: 'Space Exploration', isLive: false, isVerified: false },
                { id: 'S_H0y_0H_1I', title: 'Human Augmentation: Dawn of the Cyborg', description: 'Where are we headed when technology merges with the human body?', thumbnail: 'https://placehold.co/1280x720/9900ff/000000?text=Human+Augmentation', channel: 'Biomechanical Research', views: '2.8M', uploadTime: '1 year 4 months ago', category: 'Life Sciences', isLive: false, isVerified: true },
                { id: 'T_I1z_1I_2J', title: 'Energy Revolution: Breakthroughs in Nuclear Fusion', description: 'When will clean, limitless nuclear fusion energy become a reality?', thumbnail: 'https://placehold.co/1280x720/ff0033/000000?text=Nuclear+Fusion', channel: 'New Energy Exploration', views: '3.2M', uploadTime: '1 year 5 months ago', category: 'Future Tech', isLive: false, isVerified: false },
                { id: 'U_J2x_2J_3K', title: 'Lost Technologies of Ancient Civilizations: Mystery of Atlantis', description: 'Explore the advanced technologies of the legendary Atlantis civilization and how they were lost.', thumbnail: 'https://placehold.co/1280x720/8B4513/FFFFFF?text=Lost+Tech', channel: 'History Uncovered', views: '5M', uploadTime: '6 months ago', category: 'Historical Data', isLive: false, isVerified: true },
                { id: 'V_K3y_3K_4L', title: 'Deep Space Exploration: Discoveries of Next-Gen Telescopes', description: 'How is the James Webb Space Telescope revealing the early secrets of the universe?', thumbnail: 'https://placehold.co/1280x720/4682B4/FFFFFF?text=Deep+Space', channel: 'Cosmic Observatory', views: '7.5M', uploadTime: '2 months ago', category: 'Space Exploration', isLive: false, isVerified: false },
                { id: 'W_L4z_4L_5M', title: 'Fusion of Art & Data: Evolution of Generative Art', description: 'How is artificial intelligence creating stunning visual artworks?', thumbnail: 'https://placehold.co/1280x720/9370DB/FFFFFF?text=Generative+Art', channel: 'Digital Artist', views: '3M', uploadTime: '1 month ago', category: 'AI Evolution', isLive: false, isVerified: true },
                { id: 'X_M5x_5M_6N', title: 'Digital Simulation of Earth Ecosystems: Climate Change Warning', description: 'How are high-precision digital models predicting future trends of Earth\'s climate?', thumbnail: 'https://placehold.co/1280x720/2E8B57/FFFFFF?text=Eco+Simulation', channel: 'Earth Science Research', views: '4M', uploadTime: '4 months ago', category: 'Life Sciences', isLive: false, isVerified: false },
                { id: 'Y_N6y_6N_7O', title: 'Future City Planning: Vertical Farms & Smart Transport', description: 'Explore how future cities achieve sustainable development and efficient operations.', thumbnail: 'https://placehold.co/1280x720/FFD700/000000?text=Future+City', channel: 'Urban Planners', views: '6M', uploadTime: '3 months ago', category: 'Future Tech', isLive: false, isVerified: true },
                { id: 'Z_O7z_7O_8P', title: 'Boundaries of Human Consciousness: Intertwining Dreams & Reality', description: 'How does neuroscience explain the nature of dreams and their impact on reality?', thumbnail: 'https://placehold.co/1280x720/D2B48C/000000?text=Consciousness', channel: 'Psychology Explorer', views: '2.5M', uploadTime: '5 months ago', category: 'Life Sciences', isLive: false, isVerified: false }
            ];

            // Get DOM elements
            const homeVideoGrid = document.getElementById('home-video-grid');
            const trendingVideoGrid = document.getElementById('trending-video-grid');
            const musicVideoGrid = document.getElementById('music-video-grid');
            const sidebar = document.getElementById('sidebar');
            const sidebarToggle = document.getElementById('sidebar-toggle');
            const messageBox = document.getElementById('message-box');
            const categoryTagsContainer = document.getElementById('category-tags');
            const userAvatar = document.getElementById('user-avatar');
            const accountMenu = document.getElementById('account-menu');
            const languageOption = document.getElementById('language-option');
            const languageSubmenu = document.getElementById('language-submenu');
            const loadingOverlay = document.getElementById('loading-overlay'); // 獲取載入遮罩元素

            // --- 新增的翻譯模擬函數 ---
            // 這個函數模擬從外部機器翻譯服務獲取翻譯
            // 在實際應用中，您會將此替換為對真實翻譯 API 的呼叫
            async function fetchTranslation(lang, key) {
                // 為了演示，我們在這裡硬編碼一些翻譯。
                // 實際上，這裡會發送一個 HTTP 請求到翻譯服務。
                const simulatedTranslations = {
                    "en": {
                        "title": "LumiStream Realm - Future Video Platform",
                        "app_name": "LumiStream Realm",
                        "search_placeholder": "Search videos...",
                        "upload_button_text": "Upload Video",
                        "sidebar_home_text": "Home",
                        "sidebar_explore_text": "Explore",
                        "sidebar_subscriptions_text": "Subscriptions",
                        "sidebar_library_text": "Library",
                        "sidebar_history_text": "History",
                        "sidebar_your_videos_text": "Your Videos",
                        "sidebar_watch_later_text": "Watch Later",
                        "sidebar_liked_videos_text": "Liked Videos",
                        "sidebar_more": "More",
                        "sidebar_settings_text": "Settings",
                        "sidebar_help_text": "Help",
                        "sidebar_feedback_text": "Feedback",
                        "categories_title": "Categories",
                        "category_all_text": "All",
                        "category_tech_text": "Tech",
                        "category_space_text": "Space",
                        "category_ai_text": "AI",
                        "category_life_science_text": "Life Science",
                        "category_history_text": "History",
                        "recommended_title": "Recommended for You",
                        "trending_title": "Trending Videos",
                        "music_title": "Music",
                        "live_badge": "LIVE",
                        "views_suffix": " views",
                        "footer_text": "© 2025 LumiStream Realm. All rights reserved.",
                        "account_menu_channel_text": "My Channel",
                        "account_menu_settings_text": "Settings",
                        "account_menu_language_text": "Language",
                        "account_menu_help_text": "Help",
                        "account_menu_feedback_text": "Feedback",
                        "account_menu_signout_text": "Sign Out",
                        "message_filtered_by": "Filtered by: {filtered_category}",
                        "message_language_set": "Language set to: {selected_language}",
                        "message_clicked": "Clicked: {clicked_item}"
                    },
                    "ja": {
                        "title": "LumiStream Realm - 未来の動画プラットフォーム",
                        "app_name": "LumiStream Realm",
                        "search_placeholder": "動画を検索...",
                        "upload_button_text": "動画をアップロード",
                        "sidebar_home_text": "ホーム",
                        "sidebar_explore_text": "探索",
                        "sidebar_subscriptions_text": "登録チャンネル",
                        "sidebar_library_text": "ライブラリ",
                        "sidebar_history_text": "履歴",
                        "sidebar_your_videos_text": "あなたの動画",
                        "sidebar_watch_later_text": "後で見る",
                        "sidebar_liked_videos_text": "高く評価した動画",
                        "sidebar_more": "その他",
                        "sidebar_settings_text": "設定",
                        "sidebar_help_text": "ヘルプ",
                        "sidebar_feedback_text": "フィードバック",
                        "categories_title": "カテゴリ",
                        "category_all_text": "すべて",
                        "category_tech_text": "テクノロジー",
                        "category_space_text": "宇宙探査",
                        "category_ai_text": "AI",
                        "category_life_science_text": "生命科学",
                        "category_history_text": "歴史",
                        "recommended_title": "あなたへのおすすめ",
                        "trending_title": "トレンド動画",
                        "music_title": "音楽",
                        "live_badge": "ライブ中",
                        "views_suffix": " 回視聴",
                        "footer_text": "© 2025 LumiStream Realm. 無断複写・転載を禁じます。",
                        "account_menu_channel_text": "マイチャンネル",
                        "account_menu_settings_text": "設定",
                        "account_menu_language_text": "言語",
                        "account_menu_help_text": "ヘルプ",
                        "account_menu_feedback_text": "フィードバック",
                        "account_menu_signout_text": "ログアウト",
                        "message_filtered_by": "フィルタリング済み: {filtered_category}",
                        "message_language_set": "言語設定: {selected_language}",
                        "message_clicked": "クリック: {clicked_item}"
                    },
                    "zh-TW": {
                        "title": "LumiStream Realm - 未來影音平台",
                        "app_name": "LumiStream Realm",
                        "search_placeholder": "搜尋影片...",
                        "upload_button_text": "上傳影片",
                        "sidebar_home_text": "首頁",
                        "sidebar_explore_text": "探索",
                        "sidebar_subscriptions_text": "訂閱",
                        "sidebar_library_text": "媒體庫",
                        "sidebar_history_text": "觀看紀錄",
                        "sidebar_your_videos_text": "我的影片",
                        "sidebar_watch_later_text": "稍後觀看",
                        "sidebar_liked_videos_text": "喜歡的影片",
                        "sidebar_more": "更多",
                        "sidebar_settings_text": "設定",
                        "sidebar_help_text": "協助",
                        "sidebar_feedback_text": "意見回饋",
                        "categories_title": "分類",
                        "category_all_text": "全部",
                        "category_tech_text": "科技",
                        "category_space_text": "探索宇宙",
                        "category_ai_text": "人工智慧",
                        "category_life_science_text": "生命科學",
                        "category_history_text": "歷史",
                        "recommended_title": "為您推薦",
                        "trending_title": "熱門影片",
                        "music_title": "音樂",
                        "live_badge": "直播中",
                        "views_suffix": " 次觀看",
                        "footer_text": "© 2025 LumiStream Realm. 版權所有。",
                        "account_menu_channel_text": "我的頻道",
                        "account_menu_settings_text": "設定",
                        "account_menu_language_text": "語言",
                        "account_menu_help_text": "協助",
                        "account_menu_feedback_text": "意見回饋",
                        "account_menu_signout_text": "登出",
                        "message_filtered_by": "已篩選：{filtered_category}",
                        "message_language_set": "語言已設定為：{selected_language}",
                        "message_clicked": "點擊了：{clicked_item}"
                    },
                    "zh-CN": {
                        "title": "LumiStream Realm - 未来视频平台",
                        "app_name": "LumiStream Realm",
                        "search_placeholder": "搜索视频...",
                        "upload_button_text": "上传视频",
                        "sidebar_home_text": "首页",
                        "sidebar_explore_text": "探索",
                        "sidebar_subscriptions_text": "订阅",
                        "sidebar_library_text": "媒体库",
                        "sidebar_history_text": "观看历史",
                        "sidebar_your_videos_text": "我的视频",
                        "sidebar_watch_later_text": "稍后观看",
                        "sidebar_liked_videos_text": "喜欢的视频",
                        "sidebar_more": "更多",
                        "sidebar_settings_text": "设置",
                        "sidebar_help_text": "帮助",
                        "sidebar_feedback_text": "反馈",
                        "categories_title": "分类",
                        "category_all_text": "全部",
                        "category_tech_text": "科技",
                        "category_space_text": "探索宇宙",
                        "category_ai_text": "人工智能",
                        "category_life_science_text": "生命科学",
                        "category_history_text": "历史",
                        "recommended_title": "为您推荐",
                        "trending_title": "热门视频",
                        "music_title": "音乐",
                        "live_badge": "直播中",
                        "views_suffix": " 次观看",
                        "footer_text": "© 2025 LumiStream Realm. 版权所有。",
                        "account_menu_channel_text": "我的频道",
                        "account_menu_settings_text": "设置",
                        "account_menu_language_text": "语言",
                        "account_menu_help_text": "帮助",
                        "account_menu_feedback_text": "反馈",
                        "account_menu_signout_text": "退出登录",
                        "message_filtered_by": "已筛选：{filtered_category}",
                        "message_language_set": "语言已设置为：{selected_language}",
                        "message_clicked": "点击了：{clicked_item}"
                    }
                };

                // 模擬網路延遲
                await new Promise(resolve => setTimeout(resolve, 100));
                return simulatedTranslations[lang] ? simulatedTranslations[lang][key] : null;
            }

            // --- 修改後的 applyTranslations 函數 ---
            /**
             * Applies translations to all elements with data-i18n-key attribute.
             * @param {string} lang - The language code (e.g., 'en', 'ja', 'zh-TW', 'zh-CN').
             */
            async function applyTranslations(lang) {
                loadingOverlay.classList.add('show'); // 顯示載入遮罩
                document.documentElement.lang = lang; // Update HTML lang attribute

                const elements = document.querySelectorAll('[data-i18n-key]');
                for (const element of elements) {
                    const key = element.getAttribute('data-i18n-key');
                    const translatedText = await fetchTranslation(lang, key); // 直接使用 key

                    if (translatedText !== null) {
                        if (element.tagName === 'INPUT' && element.hasAttribute('placeholder')) {
                            element.placeholder = translatedText;
                        } else {
                            element.textContent = translatedText;
                        }
                    } else {
                        console.warn(`Translation key '${key}' not found for language '${lang}'`);
                    }
                }

                // 特別處理動態內容，例如影片卡片視圖和直播徽章
                // 重新渲染網格以將新語言應用於動態文本
                await renderVideoGrid(homeVideoGrid, getRandomVideos(10, currentSelectedCategory));
                await renderVideoGrid(trendingVideoGrid, getRandomVideos(5, currentSelectedCategory));
                await renderVideoGrid(musicVideoGrid, getRandomVideos(5, currentSelectedCategory));

                loadingOverlay.classList.remove('show'); // 隱藏載入遮罩
            }

            // Sidebar toggle function
            sidebarToggle.addEventListener('click', () => {
                sidebar.classList.toggle('-translate-x-full');
            });

            // Close sidebar when clicking main content area (mobile only)
            document.querySelector('main').addEventListener('click', () => {
                if (window.innerWidth < 1024 && !sidebar.classList.contains('-translate-x-full')) {
                    sidebar.classList.add('-translate-x-full');
                }
            });

            /**
             * Show message box
             * @param {string} messageKey - Message key from translations
             * @param {object} params - Parameters to replace in the message
             */
            async function showMessage(messageKey, params = {}) {
                let message = await fetchTranslation(currentLang, messageKey);
                if (message) {
                     // 替換佔位符
                    for (const key in params) {
                        message = message.replace(`{${key}}`, params[key]);
                    }
                } else {
                    message = `Translation for "${messageKey}" not found.`;
                }

                messageBox.textContent = message;
                messageBox.classList.add('show');
                setTimeout(() => {
                    messageBox.classList.remove('show');
                }, 2000); // Hide after 2 seconds
            }

            /**
             * Create video card element
             * @param {object} video - Video data object
             * @param {boolean} isMainGrid - Whether it's for the main grid layout (affects styling)
             * @returns {HTMLElement} - Video card DOM element
             */
            async function createVideoCard(video, isMainGrid = true) {
                const videoCard = document.createElement('div');
                videoCard.className = `bg-gray-800 rounded-xl shadow-lg cursor-pointer transition duration-300 ease-in-out overflow-hidden border border-gray-700 video-card-hover ${isMainGrid ? '' : 'flex items-start gap-3'}`;
                videoCard.setAttribute('data-video-id', video.id);
                videoCard.setAttribute('data-video-title', video.title);
                videoCard.setAttribute('data-video-description', video.description);

                // Video thumbnail
                const thumbnailContainer = document.createElement('div');
                if (isMainGrid) {
                    thumbnailContainer.className = 'thumbnail-container'; // Maintain 16:9 aspect ratio
                } else {
                    thumbnailContainer.className = 'w-36 h-20 flex-shrink-0 rounded-lg overflow-hidden'; // Fixed size
                }
                const thumbnail = document.createElement('img');
                thumbnail.src = video.thumbnail;
                thumbnail.alt = video.title;
                thumbnail.className = 'w-full h-full object-cover';
                thumbnailContainer.appendChild(thumbnail);

                // Live badge
                if (video.isLive) {
                    const liveBadge = document.createElement('span');
                    liveBadge.className = 'absolute top-2 right-2 bg-red-600 text-white text-xs font-bold px-2 py-1 rounded-md z-10';
                    liveBadge.textContent = await fetchTranslation(currentLang, 'live_badge'); // Use translated text
                    thumbnailContainer.appendChild(liveBadge);
                }

                videoCard.appendChild(thumbnailContainer);

                // Video info (title, channel, views, upload time)
                const videoInfo = document.createElement('div');
                videoInfo.className = `p-4 ${isMainGrid ? '' : 'flex-1 overflow-hidden'}`;

                const title = document.createElement('h4');
                title.className = `font-semibold text-cyan-300 ${isMainGrid ? 'text-base line-clamp-2' : 'text-sm line-clamp-2'}`;
                title.textContent = video.title;

                const channelContainer = document.createElement('p');
                channelContainer.className = 'text-gray-400 text-sm mt-1 flex items-center';
                channelContainer.textContent = video.channel;
                if (video.isVerified) {
                    // Verified icon is now Font Awesome
                    const verifiedIcon = document.createElement('i');
                    verifiedIcon.className = 'fas fa-check-circle text-blue-400 ml-2'; // Font Awesome class and Tailwind color
                    channelContainer.appendChild(verifiedIcon);
                }

                const meta = document.createElement('p');
                meta.className = 'text-gray-500 text-xs';
                const viewsSuffix = await fetchTranslation(currentLang, 'views_suffix');
                meta.textContent = `${video.views}${viewsSuffix} • ${video.uploadTime}`; // Use translated suffix

                videoInfo.appendChild(title);
                videoInfo.appendChild(channelContainer);
                videoInfo.appendChild(meta);

                videoCard.appendChild(videoInfo);

                return videoCard;
            }

            /**
             * Render video grid
             * @param {HTMLElement} container - Grid container DOM element
             * @param {Array<object>} videoData - Array of video data to render
             * @param {boolean} isMainGrid - Whether it's for the main grid layout
             */
            async function renderVideoGrid(container, videoData, isMainGrid = true) {
                container.innerHTML = ''; // Clear existing content
                for (const video of videoData) {
                    const card = await createVideoCard(video, isMainGrid);
                    container.appendChild(card);
                }
            }

            // Randomly select some videos to populate the grid
            function getRandomVideos(count, category = 'All Data') {
                let filteredVideos = videos;
                if (category !== 'All Data') {
                    filteredVideos = videos.filter(video => video.category === category);
                }
                const shuffled = [...filteredVideos].sort(() => 0.5 - Math.random());
                return shuffled.slice(0, count);
            }

            // Initial rendering
            let currentLang = 'en'; // Default language
            let currentSelectedCategory = 'All Data'; // Track the currently selected category

            await applyTranslations(currentLang); // Apply default language
            await renderVideoGrid(homeVideoGrid, getRandomVideos(10));
            await renderVideoGrid(trendingVideoGrid, getRandomVideos(5));
            await renderVideoGrid(musicVideoGrid, getRandomVideos(5));

            // Category tag click event
            categoryTagsContainer.querySelectorAll('.category-tag').forEach(tag => {
                tag.addEventListener('click', async (event) => {
                    const selectedCategory = event.currentTarget.dataset.category;
                    currentSelectedCategory = selectedCategory; // Update the tracked category
                    categoryTagsContainer.querySelectorAll('.category-tag').forEach(t => {
                        t.classList.remove('border-cyan-400', 'bg-cyan-900');
                        t.classList.add('bg-gray-700', 'border-gray-600');
                    });
                    event.currentTarget.classList.remove('bg-gray-700', 'border-gray-600');
                    event.currentTarget.classList.add('border-cyan-400', 'bg-cyan-900');

                    await renderVideoGrid(homeVideoGrid, getRandomVideos(10, selectedCategory));
                    await renderVideoGrid(trendingVideoGrid, getRandomVideos(5, selectedCategory));
                    await renderVideoGrid(musicVideoGrid, getRandomVideos(5, selectedCategory));

                    // 獲取分類標籤的文本
                    let categoryText = '';
                    if (event.currentTarget) { // 顯式檢查 event.currentTarget 是否為 null
                        const textSpan = event.currentTarget.querySelector('span[data-i18n-key]');
                        if (textSpan && textSpan.textContent !== null) {
                            categoryText = textSpan.textContent.trim();
                        } else if (event.currentTarget.textContent !== null) {
                            categoryText = event.currentTarget.textContent.trim();
                        } else {
                            console.error("Failed to get textContent for clicked category tag.");
                        }
                    } else {
                        console.error("Category tag is null/undefined on click.");
                    }
                    await showMessage('message_filtered_by', { filtered_category: categoryText });
                });
            });

            // Default select "All" tag
            categoryTagsContainer.querySelector('[data-category="All Data"]').classList.add('border-cyan-400', 'bg-cyan-900');
            categoryTagsContainer.querySelector('[data-category="All Data"]').classList.remove('bg-gray-700', 'border-gray-600');

            // User avatar click event
            userAvatar.addEventListener('click', (event) => {
                event.stopPropagation();
                accountMenu.classList.toggle('show');
                if (!accountMenu.classList.contains('show')) {
                    languageSubmenu.classList.remove('show');
                }
            });

            // Toggle language submenu visibility
            languageOption.addEventListener('click', (event) => {
                event.stopPropagation();
                languageSubmenu.classList.toggle('show');
            });

            // Handle language selection
            languageSubmenu.querySelectorAll('a').forEach(langItem => {
                langItem.addEventListener('click', async (event) => {
                    event.preventDefault();
                    const selectedLang = event.currentTarget.dataset.lang;
                    currentLang = selectedLang; // Update current language
                    await applyTranslations(currentLang); // Apply new language
                    await showMessage('message_language_set', { selected_language: event.currentTarget.textContent.trim() });
                    accountMenu.classList.remove('show');
                    languageSubmenu.classList.remove('show');
                });
            });

            // Close menu when clicking outside
            document.addEventListener('click', (event) => {
                if (!userAvatar.contains(event.target) && !accountMenu.contains(event.target)) {
                    accountMenu.classList.remove('show');
                    languageSubmenu.classList.remove('show');
                }
            });

            // Close menu when clicking on an item within the menu (excluding language option itself)
            accountMenu.querySelectorAll('li:not(#language-option) > a').forEach(item => {
                item.addEventListener('click', async () => {
                    accountMenu.classList.remove('show');
                    languageSubmenu.classList.remove('show');
                    // 獲取帳戶選單項目的文本
                    let clickedItemText = '';
                    if (item) { // 顯式檢查 item 是否為 null
                        const textSpan = item.querySelector('span[data-i18n-key]');
                        if (textSpan && textSpan.textContent !== null) {
                            clickedItemText = textSpan.textContent.trim();
                        } else if (item.textContent !== null) {
                            clickedItemText = item.textContent.trim();
                        } else {
                            console.error("Failed to get textContent for clicked account menu item.");
                        }
                    } else {
                        console.error("Account menu item is null/undefined on click.");
                    }
                    await showMessage('message_clicked', { clicked_item: clickedItemText });
                });
            });
        };
    </script>
</body>
</html>
